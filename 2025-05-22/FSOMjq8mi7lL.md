diff --git a/.github/workflows/main-maven-jar.yml b/.github/workflows/main-maven-jar.ymlindex 3d7905e..0f41364 100644--- a/.github/workflows/main-maven-jar.yml+++ b/.github/workflows/main-maven-jar.yml@@ -31,4 +31,6 @@ jobs:               run: mvn dependency:copy -Dartifact=plus.gaga.middleware:openai-code-review-sdk:1.0 -DoutputDirectory=./libs                          - name: Run Code Review-              run: java -jar ./libs/openai-code-review-sdk-1.0.jar\ No newline at end of file+              run: java -jar ./libs/openai-code-review-sdk-1.0.jar+              env:+                  GITHUB_TOKEN: ${{ secrets.CODE_TOKEN }}\ No newline at end of filediff --git a/openai-code-review-sdk/src/main/java/plus/gaga/middleware/sdk/OpenAiCodeReview.java b/openai-code-review-sdk/src/main/java/plus/gaga/middleware/sdk/OpenAiCodeReview.javaindex 5523726..68c2972 100644--- a/openai-code-review-sdk/src/main/java/plus/gaga/middleware/sdk/OpenAiCodeReview.java+++ b/openai-code-review-sdk/src/main/java/plus/gaga/middleware/sdk/OpenAiCodeReview.java@@ -1,6 +1,9 @@ package plus.gaga.middleware.sdk;  import com.alibaba.fastjson2.JSON;+import org.eclipse.jgit.api.Git;+import org.eclipse.jgit.api.errors.GitAPIException;+import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider; import plus.gaga.middleware.sdk.domain.model.ChatCompletionRequest; import plus.gaga.middleware.sdk.domain.model.ChatCompletionSyncResponse; import plus.gaga.middleware.sdk.domain.model.Model;@@ -10,15 +13,23 @@ import java.io.*; import java.net.HttpURLConnection; import java.net.URL; import java.nio.charset.StandardCharsets;+import java.text.SimpleDateFormat; import java.util.ArrayList;+import java.util.Date;+import java.util.Random;  public class OpenAiCodeReview {      static String apiKeySecret = "d6127788e0e84c6e81b4da035ea29e7d.DZpYkAoPaaU6SzGB";--    public static void main(String[] args) throws IOException, InterruptedException {+    static String token;+    public static void main(String[] args) throws Exception {         System.out.println("测试执行"); +        token = System.getenv("GITHUB_TOKEN");+        if (token == null || token.isEmpty()) {+            System.out.println("token is null");+        }+         // 1. 代码检出         ProcessBuilder processBuilder = new ProcessBuilder("git", "diff", "HEAD~1", "HEAD");         processBuilder.directory(new File("."));@@ -31,8 +42,12 @@ public class OpenAiCodeReview {             sb.append(line);         }         int exitCode = start.waitFor();+        String log = sb.toString();+        String logUrl = writeLog(token, log);+         System.out.println("Exited with code:" + exitCode);-        System.out.println("代码评审结果：" + codeReview(sb.toString()));+        System.out.println("代码评审结果：" + log);+        System.out.println("writeLog：" + logUrl);     }      private static String codeReview(String diffCode) throws IOException {@@ -86,4 +101,43 @@ public class OpenAiCodeReview {         return response.getChoices().get(0).getMessage().getContent();     } +    private static String writeLog(String token, String log) throws Exception {++        Git git = Git.cloneRepository()+                .setURI("https://github.com/tengta119/openai-code-review-log.git")+                .setDirectory(new File("repo"))+                .setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, ""))+                .call();++        String dateFolderName = new SimpleDateFormat("yyyy-MM-dd").format(new Date());+        File dateFolder = new File("repo/" + dateFolderName);+        if (!dateFolder.exists()) {+            dateFolder.mkdirs();+        }++        String fileName = generateRandomString(12) + ".md";+        File newFile = new File(dateFolder, fileName);+        try (FileWriter writer = new FileWriter(newFile)) {+            writer.write(log);+        }++        git.add().addFilepattern(dateFolderName + "/" + fileName).call();+        git.commit().setMessage("Add new file via GitHub Actions").call();+        git.push().setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, "")).call();++        System.out.println("Changes have been pushed to the repository.");++        return "https://github.com/tengta119/openai-code-review-log/blob/master/" + dateFolderName + "/" + fileName;+    }++    private static String generateRandomString(int length) {+        String characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";+        Random random = new Random();+        StringBuilder sb = new StringBuilder(length);+        for (int i = 0; i < length; i++) {+            sb.append(characters.charAt(random.nextInt(characters.length())));+        }+        return sb.toString();+    }+ }